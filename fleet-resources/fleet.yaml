# Main fleet.yaml controls the order of deployment
defaultNamespace: fleet-default

# Define the order by adding dependencies
targetCustomizations:
- name: namespaces
  clusterSelector:
    matchLabels:
      environment: production
  paths:
  - namespaces

- name: gpu-operator
  clusterSelector:
    matchLabels:
      environment: production
  dependsOn:
  - name: namespaces
  paths:
  - charts/gpu-operator

- name: suse-ai-apps
  clusterSelector:
    matchLabels:
      environment: production
  dependsOn:
  - name: namespaces
  - name: gpu-operator
  paths:
  - charts/ollama
  - charts/milvus
  - charts/open-webui

- name: gpu-operator-direct
  clusterSelector:
    matchLabels:
      environment: production
  paths:
  - gpu-operator-direct

- name: suse-ai-namespace-setup
  clusterSelector:
    matchLabels:
      environment: production
  # No namespace restriction to allow cluster-scoped resources
  defaultNamespace: ""
  paths:
  - suse-ai-setup
  dependsOn:
  - name: gpu-operator-direct

- name: suse-ai-deployment
  clusterSelector:
    matchLabels:
      environment: production
  # Force namespace to suse-ai using both settings
  namespace: suse-ai
  targetNamespace: suse-ai
  # Define the order of dependency
  dependsOn:
  - name: suse-ai-namespace-setup
  paths:
  - suse-ai/charts 